
<!DOCTYPE html>
<head>
	<title> Update User Form</title>		
<link rel="stylesheet"
href= "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
crossorigin="anonymous">		
<link rel="stylesheet" type="text/css" href="style.css">	
</head>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<body>	
	<br><br><br>
	<div class="container" >
		<div class="row">
		<div class="col-md-3">					
		</div>				
		<div class="col-md-7 main">						
			<h1> <b>UPDATE USER FORM</b> </h1>
			<td colspan="3"><a href="products.html"><button>Products</button></a>
                <a href="products_faves.html"><button>Favorites</button></a>
                <a href="products_others.html"><button>Other Products</button></a>
                <a href="cart.html"><button>View Cart</button></a>
                <a href="updateuser.html"><button>Update User</button></a>
                <a href="aboutus.html"><button>About us</button></a>
                <button onclick="logout()">Logout</button>
            </td>
			<form>							
			<input class="box" type="text"     id="name" placeholder="Name" required /><br>							
			<input class="box" type="email"    id="email" placeholder="E-Mail " required  pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"  title="Please enter a valid email id e.g. 'email@email.com'"/><br>							
			<input class="box" type="password" id="password" placeholder="Password " required   title="Please enter a Strong password, Must contain(Ucase, Lcase, Number, character) minimum length-8" />
			<!-- pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}" -->
			<br>
			<input class="box" type="text"     id="phone" placeholder="Phone Number " required   title="Please enter the Phone number eg- 111-111-1111"/><br>
			<!--  pattern="^(\+\d{1,2}\s)?\(?\d{3}\)?[\s.-]\d{3}[\s.-]\d{4}$" -->
			<input class="box" type="text"     id="age" placeholder="Age " required pattern="^(0?[1-9]|[1-9][0-9]|[1][1-9][1-9]|60)$" title="Age must be less than 60 "/><br><br><br>
			<button type="Submit" id="submitbutton">Update</button><br>				
			</form>
		</div>				
		<div class="col-md-3"></div></div></div>
	</body>
	<script>
		if (getCookie("userlogged") == "") {
			logout();
		}
		var endpoint = "http://localhost:3000/getuser";
		var user = getCookie("userlogged");
		
		$( document ).ready(function() {
			$.post(endpoint, {
				id: user
			}, function(data, status) {
				//console.log(data);
				if (data.message == "Success") {
					document.getElementById("name").setAttribute("value", data.user.name);
					document.getElementById("email").setAttribute("value", data.user.email);
					document.getElementById("password").setAttribute("value", data.user.password);
					document.getElementById("phone").setAttribute("value", data.user.phone_number);
					document.getElementById("age").setAttribute("value", data.user.age);
				}
			});
		});
		

		$("#submitbutton").click(function() {
			try{
			var endpoint1 = "http://localhost:3000/edituser";
			var name = $("#name").val();
			var email = $("#email").val();
			var password = $("#password").val();
			var phone_number = $("#phone").val();
			var age = $("#age").val();
			
			if (name != "" && email != "" && password != "" && phone_number != "" && age != "") {
				$.post(endpoint1, {
					_id: user,
					name: name,
					email: email,
					password: password,
					phone_number: phone_number,
					age: age
				}, function(data, status) {
					console.log("Data: " + data.message + "\nStatus: " + status);
					if (data.message == "Success") {
						alert("heyyyy");
						document.getElementById("name").setAttribute("value", data.user.name);
						document.getElementById("email").setAttribute("value", data.user.email);
						document.getElementById("password").setAttribute("value", data.user.password);
						document.getElementById("phone").setAttribute("value", data.user.phone_number);
						document.getElementById("age").setAttribute("value", data.user.age);
						window.location.href = "products.html";
					} else {
						alert("yooo");
					}
				});
			} 
			}catch(e){
				console.log(e);
			}
		});


		function setCookie(name, value, days) {
			var expires = "";
			if (days) {
				var date = new Date();
				date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
				expires = "; expires=" + date.toUTCString();
			}
			document.cookie = name + "=" + (value || "") + expires + "; path=/";
		}

		function getCookie(name) {
			var nameEQ = name + "=";
			var ca = document.cookie.split(';');
			for (var i = 0; i < ca.length; i++) {
				var c = ca[i];
				while (c.charAt(0) == ' ') c = c.substring(1, c.length);
				if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
			}
			return null;
		}

		function eraseCookie(name) {
			document.cookie = name + '=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';
		}

		function logout() {
			setCookie('userlogged', "", 7);
			setCookie('items', "", 7);
			window.location.href = "signin.html";
		}
	</script>
</html>	
